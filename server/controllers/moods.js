// Generated by CoffeeScript 1.9.0
var Mood, moment, normalizer;

Mood = require('../models/mood');

moment = require('moment');

normalizer = require('../lib/normalizer');

module.exports.all = function(req, res, next) {
  return Mood.rawRequest('statusByDay', function(err, rows) {
    var data;
    if (err) {
      return next(err);
    } else {
      data = normalizer.normalize(rows, req.day);
      return res.send(normalizer.toClientFormat(data));
    }
  });
};

module.exports.day = function(req, res, next) {
  return Mood.getMood(req.day, function(err, mood) {
    if (err) {
      return next(err);
    } else if (mood != null) {
      return res.send(mood);
    } else {
      return res.send({});
    }
  });
};

module.exports.updateDay = function(req, res, next) {
  return Mood.getMood(req.day, function(err, mood) {
    var data;
    if (err) {
      return next(err);
    } else if (mood != null) {
      mood.status = req.body.status;
      return mood.save(function(err) {
        if (err) {
          return next(err);
        } else {
          return res.send(mood);
        }
      });
    } else {
      data = {
        status: req.body.status,
        date: req.day
      };
      return Mood.create(data, function(err, mood) {
        if (err) {
          return next(err);
        } else {
          return res.send(mood);
        }
      });
    }
  });
};
